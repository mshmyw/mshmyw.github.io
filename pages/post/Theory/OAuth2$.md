---
title: "OAuth2"
date: 2019-09-29T10:36:22+08:00
# draft: true
tags: ["OAuth2"]
categories: ["OAuth2"]
---

# 它是什么

[OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html) 是目前最流行的授权机制，用来授权第三方应用，获取用户数据。目的是使得第三方应用能登录用户所拥有的系统。

OAuth 引入了一个授权层，用来分离两种不同的角色：客户端和资源所有者。......资源所有者同意以后，资源服务器可以向客户端颁发令牌。客户端通过令牌，去请求数据。

**OAuth 的核心就是向第三方应用颁发令牌。**

# 流程

以github授权流程：

1. 请求。即第三方应用向github请求授权
2. 用户确认，github返回授权码
3. 发放令牌。第三方应用通过授权码请求令牌。github【向第三方应用】发放令牌（令牌临时有效）
4. 第三方应用使用令牌登录

总结：请求授权码 - 确认 - 发放令牌 - 登录

注意，只要知道了令牌，就能进入系统。系统一般不会再次确认身份，所以**令牌必须保密，泄漏令牌与泄漏密码的后果是一样的。** 这也是为什么令牌的有效期，一般都设置得很短的原因。

# [Oauth2.0的四种方式](http://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html)

Oauth2.0共4种方式。常用的是授权码方式。

> 不管哪一种授权方式，第三方应用申请令牌之前，都必须先到系统备案，说明自己的身份，然后会拿到两个身份识别码：客户端 ID（client ID）和客户端密钥（client secret）

**授权码（authorization code）方式，指的是第三方应用先申请一个授权码，然后再用该码获取令牌**

这种方式是最常用的流程，安全性也最高，它适用于那些有后端的 Web 应用。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。

```
+----------+    1. 请 求 授 权 码      +-----------+
|          |  +--------------->   |           |
| XXXXXXX  |                      |  XXXXXXXX |
| XXXXXXX  |    2. 返 回 授 权 码      |  XXXXXXXX |
| XXXXXXX  |  <----------------+  |   XXXXXX  |
|   XXX    |                      |    XXXXX  |
|          |    3. 请 求 令 牌        |     XXX   |
|          |  +---------------->  |           |
+----------+                      +-----------+
                4. 返 回 令 牌          github
 第 三 方 应 用    <-----------------+

```



# 应用

很多网站登录时，允许使用第三方网站的身份，这称为"第三方登录"。

这让我想起控制反转。你看，你要登录第三方网站，要么你输入用户名和密码，这时主动权在第三方网站，密码对了，你才能登录。要么你给它授权，什么授权呢，就是允许它获取你的资源服务器（github）数据，授权通过，则可登录。这时，主动权在你。



一个应用要求 OAuth 授权，必须先到对方网站登记，让对方知道是谁在请求。所以，如果是github的OAuth授权，你要先去 GitHub 登记一下。

> http://www.ruanyifeng.com/blog/2019/04/github-oauth.html